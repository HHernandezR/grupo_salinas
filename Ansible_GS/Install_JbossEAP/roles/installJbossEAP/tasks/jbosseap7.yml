- name: Versión Jboss 7
  debug:
    msg: "Iniciar Ejecución de JBoss EAP Version: 7"

- name: Crear Directorios Punto de Montaje
  file:
    path: "{{ item }}"
    state: directory
    force: yes
  loop:
    - "{{ punto_montaje_nfs }}"

- name: Instalar NFS-Utils
  yum:
    name: nfs-utils
    state: present

- name: Agregar Recurso NFS Fstab
  lineinfile:
    path: "{{ path_fstab }}"
    line: "{{ recurso_nfs }}"

- name: Montar Recurso NFS
  command: "mount -a"

- name: Elimar Version Actual de Java
  yum:
    name: java
    state: absent

- name: Instalar Oracle JDK 8
  yum:
    name: "{{ punto_montaje_nfs }}{{ nombre_oracle_jdk8 }}"
    state: present

- name: Descomprimir Jboss EAP 7 ZIP
  unarchive:
    src: "{{ punto_montaje_nfs }}{{ nombre_jboss7_zip }}"
    dest: "{{ path_instalacion }}"
    copy: false
    owner: "{{ usaurio_jboss }}"
    group: "{{ grupo_jboss }}"
    mode: "{{ jboss_home_permisos }}"

# - name: Descomprimir JBoss EAP 7
#   command: "unzip {{ punto_montaje_nfs }}/{{ item }} -d {{ path_instalacion }}"
#   loop:
#     - "{{ nombre_jboss7_zip }}"

- name: Setear Variable de Entorno Java Home
  lineinfile:
    dest: "{{ path_bashprofile }}"
    regexp: "{{ item.regexp }}"
    line: "{{ item.line }}"
    insertbefore: "export PATH"
  loop:
    -
      regexp: ^JAVA_HOME=
      line: "JAVA_HOME={{ java_home }}"
    -
      regexp: PATH=\$JAVA_HOME/bin
      line: PATH=$JAVA_HOME/bin:$PATH
    -
      regexp: ^export JAVA_HOME
      line: export JAVA_HOME

- name: Setear Variable de Entorno Jboss Home
  lineinfile:
    dest: "{{ path_bashprofile }}"
    regexp: "{{ item.regexp }}"
    line: "{{ item.line }}"
    insertbefore: "export PATH"
  loop:
    -
      regexp: ^JBOSS_HOME=
      line: "JBOSS_HOME={{ jboss7_home }}"
    -
      regexp: PATH=\$JBOSS_HOME
      line: PATH=$JBOSS_HOME:$PATH
    -
      regexp: ^export JBOSS_HOME
      line: export JBOSS_HOME

- name: Recargar Variables de Entorno
  shell: "source {{ path_bashprofile }}"






# - name: Crear Directorios Punto de Montaje, Stage y Database
#   file:
#     path: "{{ item }}"
#     state: directory
#     force: yes
#   loop:
#     - "{{ punto_montaje_nfs }}"
#     - "{{ oracle_stage }}"
#     - "{{ oracle_bin_files }}"
#     - "{{ oracle_db_files }}"
#
# - name: Instalar NFS-Utils
#   yum:
#     name: nfs-utils
#     state: present
#
# - name: Agregar Recurso NFS Fstab
#   lineinfile:
#     path: "{{ path_fstab }}"
#     line: "{{ recurso_nfs }}"
#
# - name: Montar Recurso NFS
#   command: "mount -a"
#
# - name: Cambiar Permisos Directorio
#   file:
#     path: "{{ item }}"
#     owner: "{{ usaurio_oracle }}"
#     group: "{{ grupo_oracle }}"
#     mode: "{{ permisos_oracle }}"
#     recurse: yes
#   loop:
#     - "{{ oracle_bin_files }}"
#     - "{{ oracle_db_files }}"
#     - "{{ oracle_stage }}"
#
# - name: Descomprimir Oracle DataBase ZIP
#   command: "unzip {{ punto_montaje_nfs }}/{{ item }} -d {{ oracle_stage }}"
#   loop:
#     - "{{ nombre_dabatase_zip1 }}"
#     - "{{ nombre_dabatase_zip2 }}"
